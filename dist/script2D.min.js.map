{"version":3,"sources":["../dev/script2D.js"],"names":["ws","roomNameValue","connectWebSockets","roomName","WebSocket","addEventListener","message","data","JSON","parse","console","log","type","game","shiftGravity","direction","player","playerIndex","b","r","c","makeMove","send","stringify","userId","username","room","getGameState","getURLParameter","name","decodeURIComponent","RegExp","exec","location","search","replace","sendMove","gameState","sendState","saveGameState","fetch","method","body","headers","Accept","Content-Type","then","res","json","board","render","window","getParameters","parameters","parametersString","substring","length","split","forEach","p","k","v","rotation","mouseIsDown","resetButton","content","innerHTML","g","span","GameLogic","gravityEnabled","gameBoard","GameBoard","parseInt","players","appendChild","boardElement","roomNameTitle","innerText","click","hoveredObject","clickedObject","arrowModels","arrowNames","rotations","x","y","z","positions","scene","THREE","Scene","camera","PerspectiveCamera","position","renderer","WebGLRenderer","alpha","antialias","setPixelRatio","devicePixelRatio","setSize","domElement","id","arrowsContainer","loader","ObjectLoader","raycaster","Raycaster","mouse","Vector2","light","DirectionalLight","set","normalize","add","a","load","model","Math","PI","children","material","emissive","setHex","push","arrowIndex","requestAnimationFrame","lookAt","updateMatrixWorld","setFromCamera","intersects","intersectObjects","object","toLowerCase","startsWith","parent","document","style","cursor","arrow","setRotation","sin","cos","this","rotate","event","sizeY","target","height","sizeX","width","offsetX","offsetY","arrowsCanvas","rendererDomElement","deltaY","rotationValue","e","code","toggleExploded","innerWidth","innerHeight","aspect","updateProjectionMatrix","initArrows","detail"],"mappings":"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","file":"script2D.min.js","sourcesContent":["\"use strict\"\r\n\r\nlet ws\r\nlet roomNameValue\r\n\r\nwindow.getParameters = () => {\r\n\r\n    const parameters = {}\r\n\r\n    // Pull query parameters from url\r\n    const parametersString = location.search.substring(1)\r\n\r\n    if (parametersString.length) {\r\n        parametersString.split(\"&\").forEach(p => {\r\n            const [k,v] =  p.split(\"=\")\r\n            parameters[k] = v\r\n        })\r\n    }\r\n\r\n    return parameters\r\n}\r\n\r\nwindow.addEventListener(\"load\", () => {\r\n\r\n    // let isRotating = false\r\n    let rotation = 45\r\n    let mouseIsDown = false\r\n    // let isRotatingTimeout\r\n\r\n    resetButton.addEventListener(\"click\", () => {\r\n        content.innerHTML = \"\"\r\n\r\n        const {g, span, p} = getParameters()\r\n\r\n        window.game = new GameLogic({\r\n            gravityEnabled: !g || g==\"1\",\r\n            gameBoard: GameBoard,\r\n            span: parseInt(span) || 3,\r\n            players: parseInt(p) || 2\r\n            // isTraining: false,\r\n            // aiOpponent: aiOpponentCheckbox.checked,\r\n            // isMultiplayer: false\r\n        })\r\n        content.appendChild(game.board.boardElement)\r\n\r\n        roomNameValue = getURLParameter(\"roomName\")\r\n\r\n        if (roomNameValue !== \"\") {\r\n            connectWebSockets(roomNameValue)\r\n            roomNameTitle.innerText = roomNameValue\r\n        }\r\n    })\r\n    resetButton.click()\r\n\r\n\r\n\r\n    // Arrows stuff\r\n    const initArrows = () => {\r\n\r\n        let hoveredObject\r\n        let clickedObject\r\n        const WHITE = 0xaaaaaa\r\n        const YELLOW = 0xaaaa00\r\n        const CYAN = 0x00aaaa\r\n        const arrowModels = []\r\n        const arrowNames = [\"left\", \"right\", \"up\", \"down\", \"forward\", \"backward\"]\r\n        const rotations = [\r\n            {x: 0.25, y: 0.0, z: 0}, // left\r\n            {x: 0.25, y: 0.50, z: 0}, // right\r\n            {x: 0.25, y: 0.75, z: 0}, // up\r\n            {x: 0.25, y: 0.25, z: 0}, // down\r\n            {x: 0.25, y: 0.50, z: 0.25}, // forward\r\n            {x: 0.25, y: 0.50, z: 0.75} // backward\r\n        ]\r\n        const positions = [\r\n            {x: -0.125, y: 0, z: 0}, // left\r\n            {x: 0.125, y: 0, z: 0}, // right\r\n            {x: 0, y: 0.1, z: 0}, // up\r\n            {x: 0, y: -0.1, z: 0}, // down\r\n            {x: 0, y: 0, z: -0.125}, // forward\r\n            {x: 0, y: 0, z: 0.125} // backward\r\n        ]\r\n\r\n        const scene = new THREE.Scene()\r\n        const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000)\r\n        camera.position.z = 4\r\n        camera.position.y = 2\r\n        const renderer = new THREE.WebGLRenderer({alpha: true, antialias: true})\r\n        renderer.setPixelRatio( window.devicePixelRatio )\r\n        renderer.setSize(400, 400)\r\n        renderer.domElement.id = \"arrowsCanvas\"\r\n        arrowsContainer.appendChild(renderer.domElement)\r\n\r\n        const loader = new THREE.ObjectLoader()\r\n        const raycaster = new THREE.Raycaster()\r\n        const mouse = new THREE.Vector2()\r\n        const light = new THREE.DirectionalLight( 0xffffff, 0.5 )\r\n        light.position.set( 0, 1, 0 ).normalize()\r\n        scene.add(light)\r\n\r\n        for (let a=0; a<6; a++) {\r\n            loader.load(\"lib/arrow.json\", model => {\r\n\r\n                model.position.x = positions[a].x * 2 * Math.PI\r\n                model.position.y = positions[a].y * 2 * Math.PI\r\n                model.position.z = positions[a].z * 2 * Math.PI\r\n\r\n                model.rotation.x = rotations[a].x * 2 * Math.PI\r\n                model.rotation.y = rotations[a].y * 2 * Math.PI\r\n                model.rotation.z = rotations[a].z * 2 * Math.PI\r\n\r\n                model.children.forEach(c => {\r\n                    if (a==3) {\r\n                        c.material.emissive.setHex(CYAN)\r\n                        clickedObject = model\r\n                    } else {\r\n                        c.material.emissive.setHex(WHITE)\r\n                    }\r\n                })\r\n\r\n                arrowModels.push(model)\r\n                model.data = {arrowIndex: a}\r\n                scene.add(model)\r\n            })\r\n        }\r\n\r\n        const render = () => {\r\n            requestAnimationFrame(render)\r\n            camera.lookAt(scene.position)\r\n\r\n            // const vector = new THREE.Vector3(mouse.x, mouse.y, 1)\r\n            camera.updateMatrixWorld()\r\n            raycaster.setFromCamera( mouse, camera )\r\n\r\n            const intersects = raycaster.intersectObjects(scene.children, true)\r\n\r\n            if (intersects.length) {\r\n\r\n                hoveredObject = intersects[0].object.name.toLowerCase().startsWith(\"box\") ? intersects[0].object.parent : intersects[0].object\r\n\r\n                document.body.style.cursor = \"pointer\"\r\n\r\n                if (hoveredObject == clickedObject) {\r\n                    // do nothing\r\n                } else {\r\n\r\n                    if (mouseIsDown) {\r\n                        if (clickedObject) {\r\n                            // Clear old one\r\n                            clickedObject.children.forEach(c => c.material.emissive.setHex(WHITE))\r\n                        }\r\n\r\n                        // Set new one to cyan\r\n                        hoveredObject.children.forEach(c => c.material.emissive.setHex(CYAN))\r\n                        clickedObject = hoveredObject\r\n                        console.log(\"clicked\", arrowNames[clickedObject.data.arrowIndex])\r\n                        if (ws){\r\n                            ws.send(JSON.stringify({\r\n                                direction: arrowNames[clickedObject.data.arrowIndex],\r\n                                userId: \"1234\",\r\n                                username: \"rob\",\r\n                                type: \"text\",\r\n                                room: roomNameValue,\r\n                                type: \"gravity\"\r\n                            }))\r\n\r\n                        } else {\r\n                            game.shiftGravity(arrowNames[clickedObject.data.arrowIndex])\r\n                        }\r\n                    } else {\r\n                        // Hovering over non clicked item without the mouse down\r\n                        arrowModels.forEach(arrow => {\r\n                            if (arrow != clickedObject) {\r\n                                arrow.children.forEach(c => c.material.emissive.setHex(WHITE))\r\n                            }\r\n                        })\r\n\r\n                        if (hoveredObject != clickedObject) {\r\n                            hoveredObject.children.forEach(c => c.material.emissive.setHex(YELLOW))\r\n                        }\r\n                    }\r\n                }\r\n\r\n            } else {\r\n                document.body.style.cursor = \"default\"\r\n                if (arrowModels) {\r\n                    arrowModels.forEach(arrow => {\r\n\r\n                        if (arrow != clickedObject) {\r\n                            arrow.children.forEach(c => c.material.emissive.setHex(WHITE))\r\n                        }\r\n                    })\r\n                }\r\n                hoveredObject = null\r\n            }\r\n            renderer.render(scene, camera)\r\n        }\r\n\r\n        render()\r\n\r\n        const setRotation = rotation => {\r\n            camera.position.x = Math.sin(rotation*Math.PI/180) * 3\r\n            camera.position.z = Math.cos(rotation*Math.PI/180) * 3\r\n            this.game.board.rotation = rotation\r\n            this.game.board.rotate()\r\n        }\r\n        setRotation(rotation=-45)\r\n\r\n        renderer.domElement.addEventListener(\"mousemove\", event => {\r\n            const sizeY = event.target.height\r\n            const sizeX = event.target.width\r\n            mouse.x = event.offsetX / sizeX * 2 - 1\r\n            mouse.y = -event.offsetY / sizeY * 2 + 1\r\n        }, false)\r\n\r\n        document.addEventListener(\"mousedown\", event => {\r\n            if (event.target == arrowsCanvas) {\r\n                mouseIsDown = true\r\n            } else if (event.target == rendererDomElement) {\r\n                game.board.mouseIsDown = true\r\n            }\r\n        })\r\n\r\n        document.addEventListener(\"mouseup\", () => {\r\n            mouseIsDown = false\r\n            game.board.mouseIsDown = false\r\n        })\r\n\r\n        document.addEventListener(\"click\", () => {\r\n            mouseIsDown = false\r\n            game.board.mouseIsDown = false\r\n        })\r\n\r\n        window.addEventListener(\"wheel\", ({deltaY}) => {\r\n            game.board.rotationValue += (deltaY > 0 ? 1 : -1) * 5\r\n            game.board.rotate()\r\n\r\n            rotation = (rotation + (deltaY > 0 ? 1 : -1) * 5) % 360\r\n            setRotation(rotation)\r\n        })\r\n\r\n\r\n        window.addEventListener(\"keydown\", e => {\r\n            if (e.code == \"Space\") {\r\n                game.board.toggleExploded()\r\n            }\r\n        })\r\n\r\n        // Resize the rendered element on window resize\r\n        window.addEventListener(\"resize\", () => {\r\n            game.board.renderer.setSize(window.innerWidth-100, window.innerHeight-200)\r\n            game.board.camera.aspect = window.innerWidth / window.innerHeight\r\n            game.board.camera.updateProjectionMatrix()\r\n        })\r\n    }\r\n    initArrows()\r\n\r\n    window.addEventListener(\"T^3Win\", ({detail}) => console.log(`Player ${detail} wins`))\r\n    window.addEventListener(\"T^3Tie\", ({detail}) => console.log(`Tied by player ${detail}`))\r\n})\r\n\r\n\r\n\r\nfunction connectWebSockets(roomName) {\r\n    ws =  new WebSocket(\"ws://vrscrible.localhost:8001/\" + roomName)\r\n\r\n    ws.addEventListener(\"message\", (message) => {\r\n        const data = JSON.parse(message.data)\r\n        console.log(data)\r\n\r\n        if (data.type === \"gravity\") {\r\n            game.shiftGravity(data.direction)\r\n\r\n        } else if (data.type === \"move\") {\r\n\r\n            const player = data.playerIndex\r\n            const {b, r, c} = data\r\n            console.log(player, b, r, c)\r\n            game.makeMove(player, b, r, c)\r\n        }\r\n    })\r\n\r\n    ws.addEventListener(\"open\", () => {\r\n        console.log(\"connect ws\")\r\n        console.log(roomName)\r\n        ws.send(JSON.stringify({userId: \"1234\", username: \"rob\", type: \"setUp\", room: roomName }))\r\n\r\n        getGameState(roomName)\r\n    })\r\n}\r\n\r\nfunction getURLParameter(name) {\r\n    // https://stackoverflow.com/questions/11582512/how-to-get-url-parameters-with-javascript\r\n    return decodeURIComponent((new RegExp(\"[?|&]\" + name + \"=\" + \"([^&;]+?)(&|#|;|$)\").exec(location.search) || [null, \"\"])[1].replace(/\\+/g, \"%20\")) || null\r\n}\r\n\r\nfunction sendMove(playerIndex, b, r, c, gameState) {\r\n    if (ws){\r\n        ws.send(JSON.stringify({\r\n            playerIndex: playerIndex,\r\n            b: b,\r\n            r: r,\r\n            c: c,\r\n            userId: \"1234\",\r\n            username: \"rob\",\r\n            room: roomNameValue,\r\n            type: \"move\",\r\n            gameState: gameState\r\n        }))\r\n    }\r\n}\r\n\r\nfunction sendState(gameState) {\r\n    if (ws){\r\n        ws.send(JSON.stringify({\r\n            room: roomNameValue,\r\n            type: \"state\",\r\n            gameState: gameState\r\n        }))\r\n    }\r\n}\r\n\r\nfunction saveGameState(roomName, gameState) {\r\n    fetch(\"./saveGameState\", {\r\n        method: \"post\",\r\n        body: JSON.stringify({roomName: roomName, gameState: gameState})\r\n    })\r\n}\r\n\r\nfunction getGameState(roomName) {\r\n\r\n    fetch(\"./getGameState?roomName=\" + roomName, {\r\n        method: \"get\",\r\n        headers: {\r\n            \"Accept\": \"application/json\",\r\n            \"Content-Type\": \"application/json\"\r\n        }\r\n    }).then(res => res.json())\r\n    .then(data => {\r\n        if (data.gameState !== null){\r\n            game.board.render(data.gameState)\r\n        }\r\n    })\r\n\r\n}"]}