{"version":3,"sources":["../dev/script2D.js"],"names":["ws","roomNameValue","winnerWinnerChickenDinner","e","turnPanel","classList","remove","style","display","winPanel","innerText","game","players","detail","name","noChickenDinner","connectWebSockets","roomName","WebSocket","addEventListener","message","data","JSON","parse","console","log","type","shiftGravity","direction","player","playerIndex","b","r","c","makeMove","send","stringify","userId","username","room","getGameState","getURLParameter","decodeURIComponent","RegExp","exec","location","search","replace","sendMove","gameState","setPlayerLabels","sendState","saveGameState","fetch","method","body","headers","Accept","Content-Type","then","res","json","board","render","currentTurn","nextPlayer","length","nextTurn","setupPlayersTags","htmlToPut","forEach","playerColours","toUpperCase","playersInGame","innerHTML","window","getParameters","parameters","parametersString","substring","split","p","k","v","rotation","mouseIsDown","resetButton","content","g","span","GameLogic","gravityEnabled","gameBoard","GameBoard","parseInt","appendChild","boardElement","roomNameTitle","click","hoveredObject","clickedObject","arrowModels","arrowNames","rotations","x","y","z","positions","scene","THREE","Scene","camera","PerspectiveCamera","position","renderer","WebGLRenderer","alpha","antialias","setPixelRatio","devicePixelRatio","setSize","domElement","id","arrowsContainer","loader","ObjectLoader","raycaster","Raycaster","mouse","Vector2","light","DirectionalLight","set","normalize","add","a","load","model","Math","PI","children","material","emissive","setHex","push","arrowIndex","requestAnimationFrame","lookAt","updateMatrixWorld","setFromCamera","intersects","intersectObjects","object","toLowerCase","startsWith","parent","document","cursor","arrow","setRotation","sin","cos","this","rotate","event","sizeY","target","height","sizeX","width","offsetX","offsetY","arrowsCanvas","rendererDomElement","deltaY","rotationValue","code","toggleExploded","innerWidth","innerHeight","aspect","updateProjectionMatrix","initArrows"],"mappings":"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","file":"script2D.min.js","sourcesContent":["\"use strict\"\r\n\r\nlet ws\r\nlet roomNameValue\r\n\r\nwindow.getParameters = () => {\r\n\r\n    const parameters = {}\r\n\r\n    // Pull query parameters from url\r\n    const parametersString = location.search.substring(1)\r\n\r\n    if (parametersString.length) {\r\n        parametersString.split(\"&\").forEach(p => {\r\n            const [k,v] =  p.split(\"=\")\r\n            parameters[k] = v\r\n        })\r\n    }\r\n\r\n    return parameters\r\n}\r\n\r\nwindow.addEventListener(\"load\", () => {\r\n\r\n    // let isRotating = false\r\n    let rotation = 45\r\n    let mouseIsDown = false\r\n    // let isRotatingTimeout\r\n\r\n    resetButton.addEventListener(\"click\", () => {\r\n        content.innerHTML = \"\"\r\n\r\n        const {g, span, p} = getParameters()\r\n\r\n        window.game = new GameLogic({\r\n            gravityEnabled: !g || g==\"1\",\r\n            gameBoard: GameBoard,\r\n            span: parseInt(span) || 3,\r\n            players: parseInt(p) || 2\r\n            // isTraining: false,\r\n            // aiOpponent: aiOpponentCheckbox.checked,\r\n            // isMultiplayer: false\r\n        })\r\n        content.appendChild(game.board.boardElement)\r\n\r\n        roomNameValue = getURLParameter(\"roomName\")\r\n\r\n        if (roomNameValue !== \"\") {\r\n            connectWebSockets(roomNameValue)\r\n            roomNameTitle.innerText = roomNameValue\r\n        }\r\n        setPlayerLabels()\r\n        setupPlayersTags()\r\n    })\r\n    resetButton.click()\r\n\r\n\r\n\r\n    // Arrows stuff\r\n    const initArrows = () => {\r\n\r\n        let hoveredObject\r\n        let clickedObject\r\n        const WHITE = 0xaaaaaa\r\n        const YELLOW = 0xaaaa00\r\n        const CYAN = 0x00aaaa\r\n        const arrowModels = []\r\n        const arrowNames = [\"left\", \"right\", \"up\", \"down\", \"forward\", \"backward\"]\r\n        const rotations = [\r\n            {x: 0.25, y: 0.0, z: 0}, // left\r\n            {x: 0.25, y: 0.50, z: 0}, // right\r\n            {x: 0.25, y: 0.75, z: 0}, // up\r\n            {x: 0.25, y: 0.25, z: 0}, // down\r\n            {x: 0.25, y: 0.50, z: 0.25}, // forward\r\n            {x: 0.25, y: 0.50, z: 0.75} // backward\r\n        ]\r\n        const positions = [\r\n            {x: -0.125, y: 0, z: 0}, // left\r\n            {x: 0.125, y: 0, z: 0}, // right\r\n            {x: 0, y: 0.1, z: 0}, // up\r\n            {x: 0, y: -0.1, z: 0}, // down\r\n            {x: 0, y: 0, z: -0.125}, // forward\r\n            {x: 0, y: 0, z: 0.125} // backward\r\n        ]\r\n\r\n        const scene = new THREE.Scene()\r\n        const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000)\r\n        camera.position.z = 4\r\n        camera.position.y = 2\r\n        const renderer = new THREE.WebGLRenderer({alpha: true, antialias: true})\r\n        renderer.setPixelRatio( window.devicePixelRatio )\r\n        renderer.setSize(400, 400)\r\n        renderer.domElement.id = \"arrowsCanvas\"\r\n        arrowsContainer.appendChild(renderer.domElement)\r\n\r\n        const loader = new THREE.ObjectLoader()\r\n        const raycaster = new THREE.Raycaster()\r\n        const mouse = new THREE.Vector2()\r\n        const light = new THREE.DirectionalLight( 0xffffff, 0.5 )\r\n        light.position.set( 0, 1, 0 ).normalize()\r\n        scene.add(light)\r\n\r\n        for (let a=0; a<6; a++) {\r\n            loader.load(\"lib/arrow.json\", model => {\r\n\r\n                model.position.x = positions[a].x * 2 * Math.PI\r\n                model.position.y = positions[a].y * 2 * Math.PI\r\n                model.position.z = positions[a].z * 2 * Math.PI\r\n\r\n                model.rotation.x = rotations[a].x * 2 * Math.PI\r\n                model.rotation.y = rotations[a].y * 2 * Math.PI\r\n                model.rotation.z = rotations[a].z * 2 * Math.PI\r\n\r\n                model.children.forEach(c => {\r\n                    if (a==3) {\r\n                        c.material.emissive.setHex(CYAN)\r\n                        clickedObject = model\r\n                    } else {\r\n                        c.material.emissive.setHex(WHITE)\r\n                    }\r\n                })\r\n\r\n                arrowModels.push(model)\r\n                model.data = {arrowIndex: a}\r\n                scene.add(model)\r\n            })\r\n        }\r\n\r\n        const render = () => {\r\n            requestAnimationFrame(render)\r\n            camera.lookAt(scene.position)\r\n\r\n            // const vector = new THREE.Vector3(mouse.x, mouse.y, 1)\r\n            camera.updateMatrixWorld()\r\n            raycaster.setFromCamera( mouse, camera )\r\n\r\n            const intersects = raycaster.intersectObjects(scene.children, true)\r\n\r\n            if (intersects.length) {\r\n\r\n                hoveredObject = intersects[0].object.name.toLowerCase().startsWith(\"box\") ? intersects[0].object.parent : intersects[0].object\r\n\r\n                document.body.style.cursor = \"pointer\"\r\n\r\n                if (hoveredObject == clickedObject) {\r\n                    // do nothing\r\n                } else {\r\n\r\n                    if (mouseIsDown) {\r\n                        if (clickedObject) {\r\n                            // Clear old one\r\n                            clickedObject.children.forEach(c => c.material.emissive.setHex(WHITE))\r\n                        }\r\n\r\n                        // Set new one to cyan\r\n                        hoveredObject.children.forEach(c => c.material.emissive.setHex(CYAN))\r\n                        clickedObject = hoveredObject\r\n                        console.log(\"clicked\", arrowNames[clickedObject.data.arrowIndex])\r\n                        if (ws){\r\n                            ws.send(JSON.stringify({\r\n                                direction: arrowNames[clickedObject.data.arrowIndex],\r\n                                userId: \"1234\",\r\n                                username: \"rob\",\r\n                                type: \"text\",\r\n                                room: roomNameValue,\r\n                                type: \"gravity\"\r\n                            }))\r\n\r\n                        } else {\r\n                            game.shiftGravity(arrowNames[clickedObject.data.arrowIndex])\r\n                        }\r\n                    } else {\r\n                        // Hovering over non clicked item without the mouse down\r\n                        arrowModels.forEach(arrow => {\r\n                            if (arrow != clickedObject) {\r\n                                arrow.children.forEach(c => c.material.emissive.setHex(WHITE))\r\n                            }\r\n                        })\r\n\r\n                        if (hoveredObject != clickedObject) {\r\n                            hoveredObject.children.forEach(c => c.material.emissive.setHex(YELLOW))\r\n                        }\r\n                    }\r\n                }\r\n\r\n            } else {\r\n                document.body.style.cursor = \"default\"\r\n                if (arrowModels) {\r\n                    arrowModels.forEach(arrow => {\r\n\r\n                        if (arrow != clickedObject) {\r\n                            arrow.children.forEach(c => c.material.emissive.setHex(WHITE))\r\n                        }\r\n                    })\r\n                }\r\n                hoveredObject = null\r\n            }\r\n            renderer.render(scene, camera)\r\n        }\r\n\r\n        render()\r\n\r\n        const setRotation = rotation => {\r\n            camera.position.x = Math.sin(rotation*Math.PI/180) * 3\r\n            camera.position.z = Math.cos(rotation*Math.PI/180) * 3\r\n            this.game.board.rotation = rotation\r\n            this.game.board.rotate()\r\n        }\r\n        setRotation(rotation=-45)\r\n\r\n        renderer.domElement.addEventListener(\"mousemove\", event => {\r\n            const sizeY = event.target.height\r\n            const sizeX = event.target.width\r\n            mouse.x = event.offsetX / sizeX * 2 - 1\r\n            mouse.y = -event.offsetY / sizeY * 2 + 1\r\n        }, false)\r\n\r\n        document.addEventListener(\"mousedown\", event => {\r\n            if (event.target == arrowsCanvas) {\r\n                mouseIsDown = true\r\n            } else if (event.target == rendererDomElement) {\r\n                game.board.mouseIsDown = true\r\n            }\r\n        })\r\n\r\n        document.addEventListener(\"mouseup\", () => {\r\n            mouseIsDown = false\r\n            game.board.mouseIsDown = false\r\n        })\r\n\r\n        document.addEventListener(\"click\", () => {\r\n            mouseIsDown = false\r\n            game.board.mouseIsDown = false\r\n        })\r\n\r\n        window.addEventListener(\"wheel\", ({deltaY}) => {\r\n            game.board.rotationValue += (deltaY > 0 ? 1 : -1) * 5\r\n            game.board.rotate()\r\n\r\n            rotation = (rotation + (deltaY > 0 ? 1 : -1) * 5) % 360\r\n            setRotation(rotation)\r\n        })\r\n\r\n\r\n        window.addEventListener(\"keydown\", e => {\r\n            if (e.code == \"Space\") {\r\n                game.board.toggleExploded()\r\n            }\r\n        })\r\n\r\n        // Resize the rendered element on window resize\r\n        window.addEventListener(\"resize\", () => {\r\n            game.board.renderer.setSize(window.innerWidth-100, window.innerHeight-200)\r\n            game.board.camera.aspect = window.innerWidth / window.innerHeight\r\n            game.board.camera.updateProjectionMatrix()\r\n        })\r\n    }\r\n    initArrows()\r\n\r\n    window.addEventListener(\"T^3Win\", winnerWinnerChickenDinner)\r\n    window.addEventListener(\"T^3Tie\", noChickenDinner)\r\n})\r\n\r\nfunction  winnerWinnerChickenDinner(e) {\r\n    turnPanel.classList.remove(\"d-flex\")\r\n    turnPanel.style.display = \"none\"\r\n    winPanel.style.display = \"block\"\r\n    winPanel.innerText = game.players[e.detail].name + \" Winns!\"\r\n\r\n}\r\nfunction  noChickenDinner(e) {\r\n    turnPanel.classList.remove(\"d-flex\")\r\n    turnPanel.style.display = \"none\"\r\n    winPanel.style.display = \"block\"\r\n    winPanel.innerText = game.players[e.detail].name + \" Caused a tie!\"\r\n\r\n}\r\n\r\nfunction connectWebSockets(roomName) {\r\n    ws =  new WebSocket(\"ws://vrscrible.localhost:8000/\" + roomName)\r\n\r\n    ws.addEventListener(\"message\", (message) => {\r\n        const data = JSON.parse(message.data)\r\n        console.log(data)\r\n\r\n        if (data.type === \"gravity\") {\r\n            game.shiftGravity(data.direction)\r\n\r\n        } else if (data.type === \"move\") {\r\n\r\n            const player = data.playerIndex\r\n            const {b, r, c} = data\r\n            console.log(player, b, r, c)\r\n            game.makeMove(player, b, r, c)\r\n        }\r\n    })\r\n\r\n    ws.addEventListener(\"open\", () => {\r\n        console.log(\"connect ws\")\r\n        console.log(roomName)\r\n        ws.send(JSON.stringify({userId: \"1234\", username: \"rob\", type: \"setUp\", room: roomName }))\r\n\r\n        getGameState(roomName)\r\n    })\r\n}\r\n\r\nfunction getURLParameter(name) {\r\n    // https://stackoverflow.com/questions/11582512/how-to-get-url-parameters-with-javascript\r\n    return decodeURIComponent((new RegExp(\"[?|&]\" + name + \"=\" + \"([^&;]+?)(&|#|;|$)\").exec(location.search) || [null, \"\"])[1].replace(/\\+/g, \"%20\")) || null\r\n}\r\n\r\nfunction sendMove(playerIndex, b, r, c, gameState) {\r\n    if (ws){\r\n        ws.send(JSON.stringify({\r\n            playerIndex: playerIndex,\r\n            b: b,\r\n            r: r,\r\n            c: c,\r\n            userId: \"1234\",\r\n            username: \"rob\",\r\n            room: roomNameValue,\r\n            type: \"move\",\r\n            gameState: gameState\r\n        }))\r\n    }\r\n    setPlayerLabels()\r\n}\r\n\r\nfunction sendState(gameState) {\r\n    if (ws){\r\n        ws.send(JSON.stringify({\r\n            room: roomNameValue,\r\n            type: \"state\",\r\n            gameState: gameState\r\n        }))\r\n    }\r\n}\r\n\r\nfunction saveGameState(roomName, gameState) {\r\n    fetch(\"./saveGameState\", {\r\n        method: \"post\",\r\n        body: JSON.stringify({roomName: roomName, gameState: gameState})\r\n    })\r\n}\r\n\r\nfunction getGameState(roomName) {\r\n\r\n    fetch(\"./getGameState?roomName=\" + roomName, {\r\n        method: \"get\",\r\n        headers: {\r\n            \"Accept\": \"application/json\",\r\n            \"Content-Type\": \"application/json\"\r\n        }\r\n    }).then(res => res.json())\r\n    .then(data => {\r\n        if (data.gameState !== null){\r\n            game.board.render(data.gameState)\r\n            game.gameState  = data.gameState\r\n        }\r\n    })\r\n\r\n}\r\n\r\nfunction setPlayerLabels(){\r\n    currentTurn.innerText =  game.players[game.playerIndex].name\r\n    const nextPlayer = game.playerIndex == game.players.length -  1 ? 0 : game.playerIndex + 1\r\n    nextTurn.innerText = game.players[nextPlayer].name\r\n}\r\n\r\nfunction setupPlayersTags() {\r\n    let htmlToPut = \"\"\r\n    game.players.forEach(player =>{\r\n        htmlToPut += `\r\n                              <!-- /.player -->\r\n                                <li class=\"player\">\r\n                                    <ul class=\"list-unstlyed\">\r\n                                        <li class=\"player-colour\" data-colour=\"green\">${game.board.playerColours[player.playerIndex].toUpperCase()}</li>\r\n                                        <!-- /.player-colour -->\r\n                                        <li class=\"player-name\">${player.name}:</li>\r\n                                        <!-- /.player-name -->\r\n                                        <li class=\"player-score\"></li>\r\n                                        <!-- /.player-score -->\r\n                                    </ul>\r\n                                </li> `\r\n    })\r\n    playersInGame.innerHTML = htmlToPut\r\n}"]}