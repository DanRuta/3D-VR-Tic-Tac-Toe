"use strict";let ws,roomNameValue;function winnerWinnerChickenDinner(e){turnPanel.classList.remove("d-flex"),turnPanel.style.display="none",winPanel.style.display="block",winPanel.innerText=game.players[e.detail].name+" Winns!"}function noChickenDinner(e){turnPanel.classList.remove("d-flex"),turnPanel.style.display="none",winPanel.style.display="block",winPanel.innerText=game.players[e.detail].name+" Caused a tie!"}function connectWebSockets(roomName){(ws=new WebSocket("ws://vrscrible.localhost:8000/"+roomName)).addEventListener("message",message=>{const data=JSON.parse(message.data);if(console.log(data),"gravity"===data.type)game.shiftGravity(data.direction);else if("move"===data.type){const player=data.playerIndex,{b:b,r:r,c:c}=data;console.log(player,b,r,c),game.makeMove(player,b,r,c)}}),ws.addEventListener("open",()=>{console.log("connect ws"),console.log(roomName),ws.send(JSON.stringify({userId:"1234",username:"rob",type:"setUp",room:roomName})),getGameState(roomName)})}function getURLParameter(name){return decodeURIComponent((new RegExp("[?|&]"+name+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null}function sendMove(playerIndex,b,r,c,gameState){ws&&ws.send(JSON.stringify({playerIndex:playerIndex,b:b,r:r,c:c,userId:"1234",username:"rob",room:roomNameValue,type:"move",gameState:gameState})),setPlayerLabels()}function sendState(gameState){ws&&ws.send(JSON.stringify({room:roomNameValue,type:"state",gameState:gameState}))}function saveGameState(roomName,gameState){fetch("./saveGameState",{method:"post",body:JSON.stringify({roomName:roomName,gameState:gameState})})}function getGameState(roomName){fetch("./getGameState?roomName="+roomName,{method:"get",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(res=>res.json()).then(data=>{null!==data.gameState&&(game.board.render(data.gameState),game.gameState=data.gameState)})}function setPlayerLabels(){currentTurn.innerText=game.players[game.playerIndex].name;const nextPlayer=game.playerIndex==game.players.length-1?0:game.playerIndex+1;nextTurn.innerText=game.players[nextPlayer].name}function setupPlayersTags(){let htmlToPut="";game.players.forEach(player=>{htmlToPut+=`\n                              \x3c!-- /.player --\x3e\n                                <li class="player">\n                                    <ul class="list-unstlyed">\n                                        <li class="player-colour" data-colour="green">${game.board.playerColours[player.playerIndex].toUpperCase()}</li>\n                                        \x3c!-- /.player-colour --\x3e\n                                        <li class="player-name">${player.name}:</li>\n                                        \x3c!-- /.player-name --\x3e\n                                        <li class="player-score"></li>\n                                        \x3c!-- /.player-score --\x3e\n                                    </ul>\n                                </li> `}),playersInGame.innerHTML=htmlToPut}window.getParameters=(()=>{const parameters={},parametersString=location.search.substring(1);return parametersString.length&&parametersString.split("&").forEach(p=>{const[k,v]=p.split("=");parameters[k]=v}),parameters}),window.addEventListener("load",()=>{let rotation=45,mouseIsDown=!1;resetButton.addEventListener("click",()=>{content.innerHTML="";const{g:g,span:span,p:p}=getParameters();window.game=new GameLogic({gravityEnabled:!g||"1"==g,gameBoard:GameBoard,span:parseInt(span)||3,players:parseInt(p)||2}),content.appendChild(game.board.boardElement),""!==(roomNameValue=getURLParameter("roomName"))&&(connectWebSockets(roomNameValue),roomNameTitle.innerText=roomNameValue),setPlayerLabels(),setupPlayersTags()}),resetButton.click();(()=>{let hoveredObject,clickedObject;const arrowModels=[],arrowNames=["left","right","up","down","forward","backward"],rotations=[{x:.25,y:0,z:0},{x:.25,y:.5,z:0},{x:.25,y:.75,z:0},{x:.25,y:.25,z:0},{x:.25,y:.5,z:.25},{x:.25,y:.5,z:.75}],positions=[{x:-.125,y:0,z:0},{x:.125,y:0,z:0},{x:0,y:.1,z:0},{x:0,y:-.1,z:0},{x:0,y:0,z:-.125},{x:0,y:0,z:.125}],scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,1,.1,1e3);camera.position.z=4,camera.position.y=2;const renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0});renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(400,400),renderer.domElement.id="arrowsCanvas",arrowsContainer.appendChild(renderer.domElement);const loader=new THREE.ObjectLoader,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,light=new THREE.DirectionalLight(16777215,.5);light.position.set(0,1,0).normalize(),scene.add(light);for(let a=0;a<6;a++)loader.load("lib/arrow.json",model=>{model.position.x=2*positions[a].x*Math.PI,model.position.y=2*positions[a].y*Math.PI,model.position.z=2*positions[a].z*Math.PI,model.rotation.x=2*rotations[a].x*Math.PI,model.rotation.y=2*rotations[a].y*Math.PI,model.rotation.z=2*rotations[a].z*Math.PI,model.children.forEach(c=>{3==a?(c.material.emissive.setHex(43690),clickedObject=model):c.material.emissive.setHex(11184810)}),arrowModels.push(model),model.data={arrowIndex:a},scene.add(model)});const render=()=>{requestAnimationFrame(render),camera.lookAt(scene.position),camera.updateMatrixWorld(),raycaster.setFromCamera(mouse,camera);const intersects=raycaster.intersectObjects(scene.children,!0);intersects.length?(hoveredObject=intersects[0].object.name.toLowerCase().startsWith("box")?intersects[0].object.parent:intersects[0].object,document.body.style.cursor="pointer",hoveredObject==clickedObject||(mouseIsDown?(clickedObject&&clickedObject.children.forEach(c=>c.material.emissive.setHex(11184810)),hoveredObject.children.forEach(c=>c.material.emissive.setHex(43690)),clickedObject=hoveredObject,console.log("clicked",arrowNames[clickedObject.data.arrowIndex]),ws?ws.send(JSON.stringify({direction:arrowNames[clickedObject.data.arrowIndex],userId:"1234",username:"rob",type:"text",room:roomNameValue,type:"gravity"})):game.shiftGravity(arrowNames[clickedObject.data.arrowIndex])):(arrowModels.forEach(arrow=>{arrow!=clickedObject&&arrow.children.forEach(c=>c.material.emissive.setHex(11184810))}),hoveredObject!=clickedObject&&hoveredObject.children.forEach(c=>c.material.emissive.setHex(11184640))))):(document.body.style.cursor="default",arrowModels&&arrowModels.forEach(arrow=>{arrow!=clickedObject&&arrow.children.forEach(c=>c.material.emissive.setHex(11184810))}),hoveredObject=null),renderer.render(scene,camera)};render();const setRotation=rotation=>{camera.position.x=3*Math.sin(rotation*Math.PI/180),camera.position.z=3*Math.cos(rotation*Math.PI/180),this.game.board.rotation=rotation,this.game.board.rotate()};setRotation(rotation=-45),renderer.domElement.addEventListener("mousemove",event=>{const sizeY=event.target.height,sizeX=event.target.width;mouse.x=event.offsetX/sizeX*2-1,mouse.y=-event.offsetY/sizeY*2+1},!1),document.addEventListener("mousedown",event=>{event.target==arrowsCanvas?mouseIsDown=!0:event.target==rendererDomElement&&(game.board.mouseIsDown=!0)}),document.addEventListener("mouseup",()=>{mouseIsDown=!1,game.board.mouseIsDown=!1}),document.addEventListener("click",()=>{mouseIsDown=!1,game.board.mouseIsDown=!1}),window.addEventListener("wheel",({deltaY:deltaY})=>{game.board.rotationValue+=5*(deltaY>0?1:-1),game.board.rotate(),setRotation(rotation=(rotation+5*(deltaY>0?1:-1))%360)}),window.addEventListener("keydown",e=>{"Space"==e.code&&game.board.toggleExploded()}),window.addEventListener("resize",()=>{game.board.renderer.setSize(window.innerWidth-100,window.innerHeight-200),game.board.camera.aspect=window.innerWidth/window.innerHeight,game.board.camera.updateProjectionMatrix()})})(),window.addEventListener("T^3Win",winnerWinnerChickenDinner),window.addEventListener("T^3Tie",noChickenDinner)});
//# sourceMappingURL=script2D.min.js.map