{"version":3,"sources":["game.concat.js"],"names":["GameBoard","[object Object]","game","isVR","span","this","playerColours","rotation","heightOffset","BOX_WIDTH","SPREAD","Math","floor","SPACING","SPHERE_RADIUS","SPHERE_V_COUNT","OPACITY_ON","OPACITY_OFF","explodedMult","isLerpingBoxes","colours","RED","BLUE","GREEN","PURPLE","YELLOW","ORANGE","BLACK","CYAN","PINK","BRIGHTGREY","LIGHTGREY","DARKGREY","WHITE","previewColour","playerIndex","toUpperCase","previewSphereGeometry","THREE","SphereGeometry","previewSphereMaterial","MeshLambertMaterial","color","transparent","opacity","emissive","setHex","previewSphere","Mesh","scene","Scene","camera","PerspectiveCamera","window","innerWidth","innerHeight","raycaster","Raycaster","mouse","Vector2","renderer","WebGLRenderer","alpha","antialias","setPixelRatio","devicePixelRatio","setSize","domElement","id","boardElement","light","DirectionalLight","position","set","normalize","add","y","initBoards","renderLoop","rotate","addEventListener","event","sizeY","target","height","sizeX","width","x","offsetX","offsetY","highlightedBoxes","boxes","Array","map","spheres","b","r","c","addBox","geometry","BoxGeometry","material","box","z","data","origPos","colour","sphereGeometry","sphereMaterial","sphere","length","push","cube","incr","gravity","modifier","pos","gravityEnabled","axis","start","end","location","isLerping","newPos","abs","someSphereIsLerping","requestAnimationFrame","lerpBoxes","lerpSpheres","lookAt","updateMatrixWorld","render","setFromCamera","intersects","intersectObjects","children","hoveredObject","object","parent","clearHighlightedBoxes","highlightColumn","highlightRowY","highlightRowX","getPreviewPosition","mouseIsDown","isClicked","setTimeout","gameState","ws","sendMove","makeMove","board","row","col","player","nextPlayer","addSphere","undefined","setPreviewColour","index","arrowModel","arrowModels","filter","a","arrowIndex","clickedObject","forEach","resetBoard","Number","isNaN","parseInt","addPoint","remove","sin","PI","cos","exports","GamePlayer","type","name","console","log","lastState","lastMove","fetch","method","body","JSON","stringify","then","json","move","value","GameLogic","gameBoard","players","isTraining","isMultiplayer","aiOpponent","numPlayers","resetGame","directions","up","down","left","right","forward","backward","modifiers","random","p","pickMove","boardGameState","rowGameState","clearLastState","reward","applyGravityToMove","isWinningMove","pi","dispatchEvent","CustomEvent","detail","isFull","sendState","boardIndex","tileY","tileX","match","max","mid","every","ri","bi","counts","i","direction","i2","everyBoard","moveSphere","everyColumn","checkAll","async","signOut","gapi","auth2","getAuthInstance","logoutText","classList","toggle","onSignIn","googleUser","profile","getBasicProfile","document","getElementById","textContent","getName","headers","Accept","Content-Type","email","getEmail","res","catch","error","isLoggedIn","logoutPipe","currentUser","get"],"mappings":"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","file":"game.min.js","sourcesContent":["\"use strict\"\n\nclass GameBoard {// eslint-disable-line\n\n    constructor (game, isVR) {\n\n        const {span} = game\n\n        this.playerColours = [\"blue\", \"red\", \"green\", \"purple\", \"yellow\", \"orange\", \"black\", \"cyan\", \"pink\", \"darkgrey\"]\n        this.rotation = -45\n        this.span = span\n        this.game = game // Two way binding\n        this.heightOffset = 0\n\n        // Rendering constants\n        this.BOX_WIDTH = 0.5\n        this.SPREAD = Math.floor(this.span / 2)\n        this.SPACING = 1.5\n        this.SPHERE_RADIUS = 0.2\n        this.SPHERE_V_COUNT = 50\n        this.OPACITY_ON = 0.5\n        this.OPACITY_OFF = 0.25\n\n        this.explodedMult = 1\n        this.isLerpingBoxes = false\n\n        this.colours = {\n            RED: 0xff0000,\n            BLUE: 0x0000ff,\n            GREEN: 0x00ff00,\n            PURPLE: 0x880088,\n            YELLOW: 0xffff00,\n            ORANGE: 0xff6600,\n            BLACK: 0x000000,\n            CYAN: 0x00ffff,\n            PINK: 0xffc0cb,\n            BRIGHTGREY: 0xaaaaaa,\n            LIGHTGREY: 0x999999,\n            DARKGREY: 0x666666,\n            WHITE: 0xffffff\n        }\n\n        // Create a render sphere to move around to the correct location\n        const previewColour = this.colours[this.playerColours[this.game.playerIndex].toUpperCase()]\n        const previewSphereGeometry = new THREE.SphereGeometry(this.SPHERE_RADIUS, this.SPHERE_V_COUNT, this.SPHERE_V_COUNT)\n        const previewSphereMaterial = new THREE.MeshLambertMaterial({color: previewColour, transparent: true})\n        previewSphereMaterial.opacity = 0\n        previewSphereMaterial.emissive.setHex(previewColour)\n        this.previewSphere = new THREE.Mesh(previewSphereGeometry, previewSphereMaterial)\n\n\n        if (isVR) return\n\n        this.scene = new THREE.Scene()\n        this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000)\n        this.raycaster = new THREE.Raycaster()\n        this.mouse = new THREE.Vector2()\n        this.renderer = new THREE.WebGLRenderer({alpha: true, antialias: true})\n        this.renderer.setPixelRatio(window.devicePixelRatio)\n        this.renderer.setSize(window.innerWidth-100, window.innerHeight-200)\n        this.renderer.domElement.id = \"rendererDomElement\"\n        this.boardElement = this.renderer.domElement\n\n        const light = new THREE.DirectionalLight(this.colours.LIGHTGREY, 1)\n        light.position.set(1, 1, 1).normalize()\n        this.scene.add(light)\n\n        this.camera.position.y = 2\n\n        this.scene.add(this.previewSphere)\n\n        this.initBoards()\n        this.renderLoop()\n        this.rotate()\n\n        this.boardElement.addEventListener(\"mousemove\", event => {\n            const sizeY = event.target.height\n            const sizeX = event.target.width\n            this.mouse.x = event.offsetX / sizeX * 2 - 1\n            this.mouse.y = -event.offsetY / sizeY * 2 + 1\n        }, false)\n    }\n\n    // Create volumes to store the boxes / spheres\n    initBoards () {\n        this.highlightedBoxes = []\n        this.boxes = [...new Array(this.span)].map(() => [...new Array(this.span)].map(() => [...new Array(this.span)]))\n        this.spheres = [...new Array(this.span)].map(() => [...new Array(this.span)].map(() => [...new Array(this.span)]))\n\n        // Populate the canvas with the board cubes\n        for (let b=0; b<this.span; b++) {\n            for (let r=0; r<this.span; r++) {\n                for (let c=0; c<this.span; c++) {\n                    this.addBox(b, r, c)\n                }\n            }\n        }\n    }\n\n    addBox (b, r, c) {\n        const geometry = new THREE.BoxGeometry(this.BOX_WIDTH, this.BOX_WIDTH, this.BOX_WIDTH)\n        const material = new THREE.MeshLambertMaterial({color: this.colours.DARKGREY})\n        material.opacity = this.OPACITY_OFF\n        material.transparent = true\n\n        const box = new THREE.Mesh(geometry, material)\n        box.material.emissive.setHex(this.colours.LIGHTGREY)\n\n        box.position.x = (c - this.SPREAD) * this.BOX_WIDTH * this.SPACING\n        box.position.y = (b - this.SPREAD) * this.BOX_WIDTH * this.SPACING + this.heightOffset\n        box.position.z = (r - this.SPREAD) * this.BOX_WIDTH * this.SPACING\n        box.data = {b, r, c}\n        box.origPos = {\n            x: box.position.x,\n            y: box.position.y,\n            z: box.position.z\n        }\n\n        this.scene.add(box)\n        this.boxes[b][r][c] = box\n    }\n\n    addSphere (b, r, c, colour) {\n        const sphereGeometry = new THREE.SphereGeometry(this.SPHERE_RADIUS, this.SPHERE_V_COUNT, this.SPHERE_V_COUNT)\n        const sphereMaterial = new THREE.MeshLambertMaterial({color: this.colours[colour.toUpperCase()]})\n        const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial)\n        sphere.material.emissive.setHex(this.colours[colour.toUpperCase()])\n\n        sphere.position.x = (c - this.SPREAD) * this.BOX_WIDTH * this.SPACING\n        sphere.position.y = (b - this.SPREAD) * this.BOX_WIDTH * this.SPACING + this.heightOffset\n        sphere.position.z = (r - this.SPREAD) * this.BOX_WIDTH * this.SPACING\n        sphere.origPos = {\n            x: sphere.position.x,\n            y: sphere.position.y,\n            z: sphere.position.z\n        }\n\n        // Set the sphere position to the exploded position\n        if (this.explodedMult!=1) {\n            sphere.position.x += sphere.origPos.x * this.explodedMult - sphere.position.x\n            sphere.position.y += sphere.origPos.y * this.explodedMult - sphere.position.y\n            sphere.position.z += sphere.origPos.z * this.explodedMult - sphere.position.z\n        }\n\n        this.spheres[b][r][c] = sphere\n        this.scene.add(sphere)\n    }\n\n    clearHighlightedBoxes () {\n        for (let b=0; b<this.highlightedBoxes.length; b++) {\n            this.highlightedBoxes[b].material.opacity = this.OPACITY_OFF\n            this.highlightedBoxes[b].material.emissive.setHex(this.colours.LIGHTGREY)\n        }\n        this.highlightedBoxes = []\n        this.previewSphere.material.opacity = 0\n    }\n\n    highlightColumn ({r, c}) {\n        for (let b=0; b<this.span; b++) {\n            this.boxes[b][r][c].material.opacity = this.OPACITY_ON\n            this.boxes[b][r][c].material.emissive.setHex(this.colours.DARKGREY)\n            this.highlightedBoxes.push(this.boxes[b][r][c])\n        }\n    }\n\n    highlightRowY ({b, r}) {\n        for (let c=0; c<this.span; c++) {\n            this.boxes[b][r][c].material.opacity = this.OPACITY_ON\n            this.boxes[b][r][c].material.emissive.setHex(this.colours.DARKGREY)\n            this.highlightedBoxes.push(this.boxes[b][r][c])\n        }\n    }\n\n    highlightRowX ({b, c}) {\n        for (let r=0; r<this.span; r++) {\n            this.boxes[b][r][c].material.opacity = this.OPACITY_ON\n            this.boxes[b][r][c].material.emissive.setHex(this.colours.DARKGREY)\n            this.highlightedBoxes.push(this.boxes[b][r][c])\n        }\n    }\n\n    getPreviewPosition (cube) {\n\n        const incr = this.game.gravity.modifier\n        const pos = {\n            x : cube.origPos.x,\n            y : cube.origPos.y,\n            z : cube.origPos.z\n        }\n\n        pos.b = cube.data.b\n        pos.r = cube.data.r\n        pos.c = cube.data.c\n\n        if (!this.game.gravityEnabled) {\n            return pos\n        }\n\n        switch (this.game.gravity.axis) {\n            // up/down\n            case 0:\n                // Column full\n                if (this.spheres[incr==-1 ? this.span-1 : 0][cube.data.r][cube.data.c]) {\n                    return null\n                }\n\n                pos.b = incr==-1 ? 0 : this.span-1\n\n                while (this.spheres[pos.b][cube.data.r][cube.data.c]) {\n                    pos.b -= incr\n                }\n\n                pos.y = (pos.b - this.SPREAD) * this.BOX_WIDTH * this.SPACING + this.heightOffset\n                break\n\n            // left/right\n            case 1:\n                // Row full\n                if (this.spheres[cube.data.b][cube.data.r][incr==-1 ? this.span-1 : 0]) {\n                    return null\n                }\n\n                pos.c = incr==-1 ? 0 : this.span-1\n\n                while (this.spheres[cube.data.b][cube.data.r][pos.c]) {\n                    pos.c -= incr\n                }\n\n                pos.x = (pos.c - this.SPREAD) * this.BOX_WIDTH * this.SPACING\n                break\n            // forward/backward\n            case 2:\n                // Row full\n                if (this.spheres[cube.data.b][incr==-1 ? this.span-1 : 0][cube.data.c]) {\n                    return null\n                }\n\n                pos.r = incr==-1 ? 0 : this.span-1\n\n                while (this.spheres[cube.data.b][pos.r][cube.data.c]) {\n                    pos.r -= incr\n                }\n\n                pos.z = (pos.r - this.SPREAD) * this.BOX_WIDTH * this.SPACING\n                break\n        }\n\n        if (this.explodedMult!=1) {\n            pos.x *= this.explodedMult\n            pos.y *= this.explodedMult\n            pos.z *= this.explodedMult\n        }\n\n        // Don't render it if there's already a sphere at that location\n        if (this.spheres[pos.b][pos.r][pos.c]) {\n            return null\n        }\n\n        return pos\n    }\n\n    moveSphere (start, end, axis, location) {\n\n        // Set the new position for the sphere\n        const sphere = this.spheres[start.b][start.r][start.c]\n        sphere.isLerping = true\n        sphere.newPos = {}\n        sphere.newPos.axis = axis\n        sphere.newPos[axis] = (location - this.SPREAD) * this.BOX_WIDTH * this.SPACING\n\n        // Move the spheres in the spheres state\n        this.spheres[end.b][end.r][end.c] = sphere\n        this.spheres[start.b][start.r][start.c] = null\n    }\n\n    // Lerp the boxes into position, when exploded\n    lerpBoxes () {\n        if (this.isLerpingBoxes) {\n            for (let b=0; b<this.span; b++) {\n                for (let r=0; r<this.span; r++) {\n                    for (let c=0; c<this.span; c++) {\n\n                        if (b!=this.SPREAD && r!=this.SPREAD && c!=this.SPREAD\n                            && Math.abs(this.boxes[b][r][c].position.x - this.boxes[b][r][c].origPos.x * this.explodedMult) < 0.005) {\n\n                            this.isLerpingBoxes = false\n                            this.boxes[b][r][c].position.x = this.boxes[b][r][c].origPos.x * this.explodedMult\n                            this.boxes[b][r][c].position.y = this.boxes[b][r][c].origPos.y * this.explodedMult\n                            this.boxes[b][r][c].position.z = this.boxes[b][r][c].origPos.z * this.explodedMult\n\n                            if (this.spheres[b][r][c]) {\n                                this.spheres[b][r][c].position.x += this.spheres[b][r][c].origPos.x * this.explodedMult - this.spheres[b][r][c].position.x\n                                this.spheres[b][r][c].position.y += this.spheres[b][r][c].origPos.y * this.explodedMult - this.spheres[b][r][c].position.y\n                                this.spheres[b][r][c].position.z += this.spheres[b][r][c].origPos.z * this.explodedMult - this.spheres[b][r][c].position.z\n                            }\n\n                        } else {\n                            this.boxes[b][r][c].position.x += (this.boxes[b][r][c].origPos.x * this.explodedMult - this.boxes[b][r][c].position.x) / 10\n                            this.boxes[b][r][c].position.y += (this.boxes[b][r][c].origPos.y * this.explodedMult - this.boxes[b][r][c].position.y) / 10\n                            this.boxes[b][r][c].position.z += (this.boxes[b][r][c].origPos.z * this.explodedMult - this.boxes[b][r][c].position.z) / 10\n\n                            if (this.spheres[b][r][c]) {\n                                this.spheres[b][r][c].position.x += (this.spheres[b][r][c].origPos.x * this.explodedMult - this.spheres[b][r][c].position.x) / 10\n                                this.spheres[b][r][c].position.y += (this.spheres[b][r][c].origPos.y * this.explodedMult - this.spheres[b][r][c].position.y) / 10\n                                this.spheres[b][r][c].position.z += (this.spheres[b][r][c].origPos.z * this.explodedMult - this.spheres[b][r][c].position.z) / 10\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // Lerp the spheres into their new place\n    lerpSpheres () {\n\n        this.someSphereIsLerping = false\n\n        for (let b=0; b<this.span; b++) {\n            for (let r=0; r<this.span; r++) {\n                for (let c=0; c<this.span; c++) {\n\n                    if (this.spheres[b][r][c] && this.spheres[b][r][c].isLerping) {\n\n                        this.someSphereIsLerping = true\n\n                        const sphere = this.spheres[b][r][c]\n                        const {axis} = sphere.newPos\n\n                        if (Math.abs(sphere.position[axis] - sphere.newPos[axis] * this.explodedMult) > 0.01) {\n                            sphere.position[axis] += (sphere.newPos[axis] * this.explodedMult - sphere.position[axis]) / 10\n                        } else {\n                            sphere.isLerping = false\n                            sphere.position[axis] = sphere.newPos[axis] * this.explodedMult\n                            sphere.origPos[axis] = sphere.newPos[axis]\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    renderLoop () {\n\n        requestAnimationFrame(() => this.renderLoop())\n        this.lerpBoxes()\n        this.lerpSpheres()\n\n        this.camera.lookAt(this.scene.position)\n        this.camera.updateMatrixWorld()\n\n        this.renderer.render(this.scene, this.camera)\n        this.raycaster.setFromCamera(this.mouse, this.camera)\n\n        const intersects = this.raycaster.intersectObjects(this.scene.children, true)\n\n        if (intersects.length) {\n\n            // If still hovering on the same thing...\n            if (this.hoveredObject && (this.hoveredObject==intersects[0].object || this.hoveredObject==intersects[0].object.parent)) {\n\n                if (this.mouseIsDown && !this.hoveredObject.data.isClicked) {\n                    this.hoveredObject.data.isClicked = true\n                    setTimeout(() => {\n                        if (this.hoveredObject) {\n                            this.hoveredObject.data.isClicked = false\n                        }\n                    }, 500)\n\n                    const {b, r, c} = this.previewSphere.data\n\n                    if (this.game.gameState[b][r][c]===\" \") {\n                        if (ws){\n                            sendMove(this.game.playerIndex, b, r, c, this.game.gameState)\n                        } else {\n                            this.game.makeMove(this.game.playerIndex, b, r, c)\n                        }\n                    }\n                }\n\n            } else {\n\n                // Set the currently hovered over object\n                this.hoveredObject = intersects[0].object.data ? intersects[0].object : intersects[0].object.parent\n                this.clearHighlightedBoxes()\n\n                if (this.hoveredObject.data) {\n                    // Also TODO, decide which one of these to do, based on the current gravity\n\n                    if (!this.isLerpingBoxes && !this.someSphereIsLerping) {\n\n                        if (this.game.gravityEnabled) {\n                            switch (this.game.gravity.axis) {\n                                case 0:\n                                    this.highlightColumn(this.hoveredObject.data)\n                                    break\n                                case 1:\n                                    this.highlightRowY(this.hoveredObject.data)\n                                    break\n                                case 2:\n                                    this.highlightRowX(this.hoveredObject.data)\n                                    break\n                            }\n                        } else {\n                            // Highlight only the hovered over box\n                            const {b, r, c} = this.hoveredObject.data\n                            this.boxes[b][r][c].material.opacity = this.OPACITY_ON\n                            this.boxes[b][r][c].material.emissive.setHex(this.colours.DARKGREY)\n                            this.highlightedBoxes.push(this.boxes[b][r][c])\n                        }\n\n                        // Render the preview sphere at the correct location\n                        const pos = this.getPreviewPosition(this.hoveredObject)\n\n                        if (pos) {\n                            this.previewSphere.position.x = pos.x\n                            this.previewSphere.position.y = pos.y\n                            this.previewSphere.position.z = pos.z\n                            this.previewSphere.data = {\n                                b: pos.b,\n                                r: pos.r,\n                                c: pos.c\n                            }\n                            this.previewSphere.material.opacity = 0.5\n                        }\n                        // === ?\n                        // else {\n                        //     this.previewSphere.material.opacity = 0\n                        // }\n                    }\n                }\n            }\n\n        } else {\n\n            this.clearHighlightedBoxes()\n            this.previewSphere.material.opacity = 0\n\n            if (this.hoveredObject) {\n                if (this.hoveredObject.material) {\n                    this.hoveredObject.material.emissive.setHex(this.colours.LIGHTGREY)\n                    this.hoveredObject.material.opacity = this.OPACITY_OFF\n                    this.hoveredObject.data.isClicked = false\n                } else if (this.hoveredObject.parent) {\n                    this.hoveredObject.parent.material.emissive.setHex(this.colours.LIGHTGREY)\n                    this.hoveredObject.parent.material.opacity = this.OPACITY_OFF\n                    this.hoveredObject.parent.data.isClicked = false\n                }\n\n            }\n            this.hoveredObject = null\n        }\n    }\n\n    toggleExploded () {\n        this.explodedMult = this.explodedMult==1 ? 2 : 1\n        this.previewSphere.material.opacity = 0\n        this.isLerpingBoxes = true\n    }\n\n    addPoint (board, row, col, player, nextPlayer) {\n        this.addSphere(board, row, col, this.playerColours[player].toUpperCase())\n        this.previewSphere.material.opacity = 0\n\n        if (nextPlayer!==undefined) {\n            this.setPreviewColour(nextPlayer)\n        }\n    }\n\n    setPreviewColour (playerIndex) {\n        const previewColour = this.colours[this.playerColours[playerIndex].toUpperCase()]\n        this.previewSphere.material.color.setHex(previewColour)\n        this.previewSphere.material.emissive.setHex(previewColour)\n    }\n\n    highlightArrow (index) {\n        const arrowModel = arrowModels.filter(a => a.data.arrowIndex==index)\n\n        // Clear old arrow\n        if (clickedObject) {\n            clickedObject.children.forEach(c => c.material.emissive.setHex(this.colours.BRIGHTGREY))\n        }\n\n        // Set new one to cyan\n        arrowModel[0].children.forEach(c => c.material.emissive.setHex(this.colours.CYAN))\n        clickedObject = arrowModel[0]\n    }\n\n    render (gameState) {\n        this.resetBoard()\n\n        for (let b=0; b<this.span; b++) {\n            for (let r=0; r<this.span; r++) {\n                for (let c=0; c<this.span; c++) {\n                    if (!Number.isNaN(parseInt(gameState[b][r][c]))) {\n                        this.addPoint(b, r, c, gameState[b][r][c])\n                    }\n                }\n            }\n        }\n    }\n\n    resetBoard () {\n        for (let b=0; b<this.span; b++) {\n            for (let r=0; r<this.span; r++) {\n                for (let c=0; c<this.span; c++) {\n                    if (this.spheres[b][r][c]) {\n                        this.scene.remove(this.spheres[b][r][c])\n                        this.spheres[b][r][c] = undefined\n                    }\n                }\n            }\n        }\n    }\n\n    rotate () {\n        this.camera.position.x = Math.sin(this.rotation*Math.PI/180) * (this.BOX_WIDTH * 1.5) * this.span * 2\n        this.camera.position.z = Math.cos(this.rotation*Math.PI/180) * (this.BOX_WIDTH * 1.5) * this.span * 2\n    }\n\n}\n\ntypeof window!=\"undefined\" && (window.exports = window.exports || {})\n\"use strict\"\n\nclass GamePlayer {// eslint-disable-line\n\n    constructor (type, playerIndex, game, name) {\n\n        console.log(`new ${type} player: ${playerIndex}`)\n\n        this.type = type\n        this.game = game // Two way binding\n        this.playerIndex = playerIndex\n        this.name = name\n    }\n\n    clearLastState () {\n        for (let b=0; b<this.game.span; b++) {\n            for (let r=0; r<this.game.span; r++) {\n                for (let c=0; c<this.game.span; c++) {\n                    this.lastState[b][r][c] = \" \"\n                }\n            }\n        }\n        this.lastMove = undefined\n    }\n\n    pickMove (gameState) {\n\n        if (this.type != \"AI\") return\n\n        fetch(\"./getAIMove\", {\n            method: \"post\",\n            body: JSON.stringify({gameState})\n        })\n        .then(r => r.json())\n        .then(({move}) => {\n            const [b, r, c] = move\n            this.game.makeMove(this.playerIndex, b, r, c)\n        })\n    }\n\n    reward (value, gameState) {\n\n        if (this.type != \"AI\") return\n\n        fetch(\"./rewardAI\", {\n            method: \"post\",\n            body: JSON.stringify({value, gameState})\n        })\n    }\n\n}\n\ntypeof window!=\"undefined\" && (window.exports = window.exports || {})\ntypeof window!=\"undefined\" && (window.GamePlayer = GamePlayer)\nexports.GamePlayer = GamePlayer\n\"use strict\"\n\nclass GameLogic {// eslint-disable-line\n\n    constructor ({gameState, gameBoard, gravityEnabled=true, span=3, players=2, isTraining, isMultiplayer, aiOpponent, isVR}={}) {\n\n        this.players = []\n        this.gravityEnabled = gravityEnabled\n        this.span = parseInt(span)\n        this.numPlayers = parseInt(players)\n        this.isTraining = isTraining // AI\n        this.aiOpponent = aiOpponent // AI\n        this.isMultiplayer = isMultiplayer // TODO, will be used to disallow moves until a move is made via WebSocket\n\n        this.gameState = gameState || this.resetGame() // Allow accepting an existing game state to allow loading existing match\n        this.gravity = {\n            axis: 0, // 0 for up/down, 1 for left/right, 2 for  forward/backward\n            modifier: -1 // -1 for normal, 1 for reverse\n        }\n        this.directions = {\n            up: 0,\n            down: 0,\n            left: 1,\n            right: 1,\n            forward: 2,\n            backward: 2\n        }\n        this.modifiers = {\n            up: 1,\n            down: -1,\n            left: -1,\n            right: 1,\n            forward: -1,\n            backward: 1\n        }\n\n        // Randomize who starts\n        this.playerIndex = Math.floor(Math.random()*players)\n        this.board = new gameBoard(this, isVR)\n\n        // Set the first player to either AI or human (aka the actual player)\n        if (this.aiOpponent) {\n            this.players.push(new GamePlayer(\"AI\", 0, this, \"AI\"))\n        } else {\n            this.players.push(new GamePlayer(\"local human\", 0, undefined ,\"Player 1\"))\n        }\n\n        // Set the rest to whatever was configured\n        for (let p=1; p<players; p++) {\n\n            // TODO, disallow more than 1 other player when playing against AI - model needed would be too big\n            if (this.isTraining) {\n                this.players.push(new GamePlayer(\"AI\", p, this))\n            } else if (isMultiplayer) {\n                this.players.push(new GamePlayer(\"remote human\", p, undefined, `Player ${p +1}`))\n            } else {\n                this.players.push(new GamePlayer(\"local human\", p, undefined, `Player ${p + 1}`))\n            }\n        }\n\n        // playerNum.style.color = this.board.playerColours[this.playerIndex]\n        this.players[this.playerIndex].pickMove(this.gameState)\n    }\n\n    // Create the board brand new\n    resetGame () {\n\n        const gameState = []\n\n        for (let b=0; b<this.span; b++) {\n\n            const boardGameState = []\n\n            for (let r=0; r<this.span; r++) {\n\n                const rowGameState = []\n\n                for (let c=0; c<this.span; c++) {\n                    rowGameState.push(\" \")\n                }\n\n                boardGameState.push(rowGameState)\n            }\n            gameState.push(boardGameState)\n        }\n\n        if (this.board) {\n            this.board.resetBoard()\n            // playerNum.style.color = this.board.playerColours[this.playerIndex]\n        }\n\n        // winsDisplay.style.display = \"none\"\n        this.gameState = gameState\n\n        // Clear the AI players' lastState\n        for (let p=0; p<this.players.length; p++) {\n            if (this.players[p].type == \"AI\") {\n                this.players[p].clearLastState()\n            }\n        }\n\n        return gameState\n    }\n\n    makeMove (p, b, r, c) {\n\n        if (p != this.playerIndex && !this.isTraining) {\n            console.log(\"NOT your turn!\")\n            return\n        }\n\n        // Illegal move\n        if (this.gameState[b][r][c] !== \" \") {\n            console.log(\"Illegal move\")\n\n            // Slap its hands, if it was an AI player\n            this.players[p].reward(-99, this.gameState)\n\n            // Stop the game if it's an AI, to avoid looping to stack overflow\n            if (this.players[p].type==\"AI\") {\n                this.resetGame()\n            }\n\n            return\n        }\n\n        [b, r, c] = this.applyGravityToMove(b, r, c)\n\n        this.gameState[b][r][c] = p\n        this.board.addPoint(b, r, c, p, (this.playerIndex+1) % this.players.length)\n\n        // Player wins\n        if (this.isWinningMove(b, r, c, p)) {\n            this.players[p].reward(1, this.gameState)\n            this.players.forEach((player, pi) => pi!=p && player.reward(-1, this.gameState))\n            // winsDisplay.style.display = \"inline-block\"\n            window.dispatchEvent(new CustomEvent(\"T^3Win\", {detail: p}))\n            return\n        }\n\n        // Tied game\n        if (this.isFull()) {\n            console.log(\"Tied game\")\n            this.players.forEach(player => player.reward(0.25, this.gameState))\n            window.dispatchEvent(new CustomEvent(\"T^3Tie\", {detail: p}))\n            return\n        }\n\n\n        // TODO, this might be useless - TEST\n        this.players.forEach((player, pi) => pi!=p && player.reward(0, this.gameState))\n\n        this.playerIndex = ++this.playerIndex % this.players.length\n\n        // TODO, do this outside of this class?\n        // playerNum.style.color = this.board.playerColours[this.playerIndex]\n        // winsDisplay.style.display = \"none\"\n\n        this.players[this.playerIndex].pickMove(this.gameState)\n        if (ws){\n            sendState(this.gameState)\n        }\n    }\n\n    isWinningMove (boardIndex, tileY, tileX, player) {\n\n        let match = false\n        const max = this.gameState[0].length-1\n        const mid = Math.floor(max/2)\n\n        // Check current board\n        match = this.gameState[boardIndex][tileY].every(col => col===player) // Horizontal\n            ||  this.gameState[boardIndex].every(row => row[tileX]===player) // Vertical\n            ||  (tileX + tileY)%2 === 0 && ( // Is it on a diagonal?\n                // Diagonal top-left -> bottom-right\n                this.gameState[boardIndex].every((row, ri) => row[ri]===player) ||\n                // Diagonal bottom-left -> top-right\n                this.gameState[boardIndex].every((row, ri) => row[max-ri]===player)\n            )\n\n        // Check other boards\n        // Up/Down\n        match = match || this.gameState.every(board => board[tileY][tileX] === player)\n\n        if (match) return true\n\n        // 3D diagonals\n        // Not in location unreachable by a diagonal\n        if (boardIndex !== mid || boardIndex===mid && (tileY===mid || tileX===mid)) {\n\n            match = match\n                ||  this.gameState.every((board, bi) => board[max-bi][tileX]===player) // Near-bottom -> Far-top\n                ||  this.gameState.every((board, bi) => board[bi][tileX]===player) // Far-bottom -> Near-top\n                ||  this.gameState.every((board, bi) => board[tileY][max-bi]===player) // Bottom-left -> Top-right\n                ||  this.gameState.every((board, bi) => board[tileY][bi]===player) // Bottom-right -> Top-left\n\n\n            if (match) return true\n\n            // Check cross diagonal (going from corners through the middle)\n            if (this.gameState[mid][mid][mid]===player) {\n\n                match = match\n                    ||  this.gameState.every((board, bi) => board[bi][bi]===player) // Far-bottom-left -> Near-top-right\n                    ||  this.gameState.every((board, bi) => board[max-bi][bi]===player) // Near-bottom-left -> Far-top-right\n                    ||  this.gameState.every((board, bi) => board[max-bi][max-bi]===player) // Near-bottom-right -> Far-top-left\n                    ||  this.gameState.every((board, bi) => board[bi][max-bi]===player) // Far-bottom-right -> Near-top-left\n            }\n        }\n\n        return match\n    }\n\n    isFull () {\n        for (let b=0; b<this.span; b++) {\n            for (let r=0; r<this.span; r++) {\n                for (let c=0; c<this.span; c++) {\n                    if (this.gameState[b][r][c] === \" \") {\n                        return false\n                    }\n                }\n            }\n        }\n\n        return true\n    }\n\n    applyGravityToMove (board, row, col) {\n\n        if (!this.gravityEnabled) return [board, row, col]\n\n        let counts\n\n        switch (this.gravity.axis) {\n            // Up/Down\n            case 0:\n                counts = this.gravity.modifier==-1 ? board : this.span-1-board\n\n                for (let i=0; i<counts; i++) {\n                    if (this.gameState[board + this.gravity.modifier][row][col]===\" \") {\n                        board += this.gravity.modifier\n                    } else {\n                        break\n                    }\n                }\n                break\n            // Left/Right\n            case 1:\n\n                counts = this.gravity.modifier==-1 ? col : this.span-1-col\n\n                for (let i=0; i<counts; i++) {\n                    if (this.gameState[board][row][col + this.gravity.modifier]===\" \") {\n                        col += this.gravity.modifier\n                    } else {\n                        break\n                    }\n                }\n                break\n            // Forward/Backward\n            case 2:\n\n                counts = this.gravity.modifier==-1 ? row : this.span-1-row\n\n                for (let i=0; i<counts; i++) {\n                    if (this.gameState[board][row + this.gravity.modifier][col]===\" \") {\n                        row += this.gravity.modifier\n                    } else {\n                        break\n                    }\n                }\n                break\n        }\n\n        return [board, row, col]\n    }\n\n    /*\n        TODO, there's a bug where some points don't move as needed. I think this may be due\n        to the order in which the tiles are moved\n    */\n    shiftGravity (direction) {\n\n        this.gravity.axis = this.directions[direction]\n        this.gravity.modifier = this.modifiers[direction]\n\n        const max = Math.abs((this.gravity.modifier==-1 ? this.span-1 : 0)-(this.span-1))\n\n        switch (this.gravity.axis) {\n\n            // Up/Down (boards)\n            case 0:\n                // For every row\n                for (let r=0; r<this.span; r++) {\n                    // For every column\n                    for (let c=0; c<this.span; c++) {\n\n                        let i2 = 0\n\n                        everyBoard:\n                        for (let i=0; i<this.span; i++) {\n\n                            if (this.gameState[Math.abs(max-i)][r][c]===\" \") {\n\n                                i2 = i+1\n\n                                while (i2<this.span) {\n                                    if (i2<this.span && i<this.span && this.gameState[Math.abs(max-i2)][r][c] !== \" \") {\n\n                                        this.board.moveSphere({b: Math.abs(max-i2), r, c}, {b: Math.abs(max-i), r, c}, \"y\", Math.abs(max-i))\n\n                                        this.gameState[Math.abs(max-i)][r][c] = this.gameState[Math.abs(max-i2)][r][c]\n                                        this.gameState[Math.abs(max-i2)][r][c] = \" \"\n\n                                        i += i2\n                                    }\n\n                                    i2++\n                                }\n                                break everyBoard\n                            }\n                        }\n                    }\n                }\n                break\n\n            // Left/Right (columns)\n            case 1:\n\n                // For every board\n                for (let b=0; b<this.span; b++) {\n                    // For every row\n                    for (let r=0; r<this.span; r++) {\n\n                        let i2 = 0\n\n                        everyColumn:\n                        for (let i=0; i<this.span; i++) {\n\n                            if (this.gameState[b][r][Math.abs(max-i)]===\" \") {\n\n                                i2 = i+1\n\n                                while (i2<this.span) {\n                                    if (i2<this.span && i<this.span && this.gameState[b][r][Math.abs(max-i2)]!==\" \") {\n\n                                        this.board.moveSphere({b, r, c: Math.abs(max-i2)}, {b, r, c: Math.abs(max-i)}, \"x\", Math.abs(max-i))\n\n                                        this.gameState[b][r][Math.abs(max-i)] = this.gameState[b][r][Math.abs(max-i2)]\n                                        this.gameState[b][r][Math.abs(max-i2)] = \" \"\n\n                                        i += i2\n                                    }\n\n                                    i2++\n                                }\n                                break everyColumn\n                            }\n\n                        }\n\n                    }\n                }\n                break\n\n            // Forward/Backward (rows)\n            case 2:\n\n                // For every board\n                for (let b=0; b<this.span; b++) {\n                    // For every row\n                    for (let r=0; r<this.span; r++) {\n\n                        let i2 = 0\n\n                        everyColumn:\n                        for (let i=0; i<this.span; i++) {\n\n                            if (this.gameState[b][Math.abs(max-i)][r]===\" \") {\n\n                                i2 = i+1\n\n                                while (i2<this.span) {\n                                    if (i2<this.span && i<this.span && this.gameState[b][Math.abs(max-i2)][r]!==\" \") {\n\n                                        this.board.moveSphere({b, r: Math.abs(max-i2), c: r}, {b, r: Math.abs(max-i), c: r}, \"z\", Math.abs(max-i))\n\n                                        this.gameState[b][Math.abs(max-i)][r] = this.gameState[b][Math.abs(max-i2)][r]\n                                        this.gameState[b][Math.abs(max-i2)][r] = \" \"\n\n                                        i += i2\n                                    }\n\n                                    i2++\n                                }\n                                break everyColumn\n                            }\n                        }\n                    }\n                }\n\n                break\n        }\n\n        this.checkAll()\n\n        this.board.clearHighlightedBoxes()\n        this.board.setPreviewColour(this.playerIndex)\n    }\n\n\n    // Check the game status for all placed items (when the gravity is changed, and every item is potentially re-arranged)\n    // TODO, optimize this, as this is insanely inefficient\n    checkAll () {\n        let match = false\n        let player\n\n        for (let b=0; b<this.span; b++) {\n            for (let r=0; r<this.span; r++) {\n                for (let c=0; c<this.span; c++) {\n\n                    if (this.gameState[b][r][c] !== \" \") {\n                        match = match || this.isWinningMove(b, r, c, this.gameState[b][r][c])\n                        if (match) {\n                            player = this.gameState[b][r][c]\n                            break\n                        }\n                    }\n                }\n            }\n        }\n\n\n        return player\n\n\n        // if (match) {\n        //     playerNum.style.color = this.board.playerColours[player]\n        //     winsDisplay.style.display = \"inline-block\"\n        // } else {\n        //     this.playerIndex = ++this.playerIndex % this.players.length\n        //     winsDisplay.style.display = \"none\"\n        //     playerNum.style.color = this.board.playerColours[this.playerIndex]\n        // }\n    }\n\n}\n\ntypeof window!=\"undefined\" && (window.exports = window.exports || {})\ntypeof window!=\"undefined\" && (window.GameLogic = GameLogic)\nexports.GameLogic = GameLogic\n//Ben's JS\n\nasync function signOut() {\n    await gapi.auth2.getAuthInstance().signOut()\n    console.log(\"User signed out.\")\n    logoutText.classList.toggle(\"invisible\")\n}\n\nasync function onSignIn(googleUser) {\n    const profile = googleUser.getBasicProfile()\n\n    const el = document.getElementById(\"welcomeTitle\")\n    el.textContent = \"Welcome, \" + profile.getName() + \"!\"\n    fetch(\"./loginUser\", {\n        method: \"post\",\n        headers: {\n            \"Accept\": \"application/json, text/plain, */*\",\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({name: profile.getName(), email: profile.getEmail()})\n    }).then(res=>res.json())\n    .catch(error => console.error(\"Error:\", error))\n    .then(res => console.log(res))\n}\n\nfunction isLoggedIn() {\n    const logoutText = document.getElementById(\"logoutText\")\n    const logoutPipe = document.getElementById(\"logoutPipe\")\n    const user = gapi.auth2.getAuthInstance().currentUser.get()\n    if (user) {\n        logoutText.classList.toggle(\"d-none\")\n        logoutPipe.classList.toggle(\"d-none\")\n\n    }\n}\n\n//# sourceMappingURL=game.concat.js.map"]}